{% extends 'base.html' %}
{% load humanize %}
{% block title %}Bus scolaire - Relances{% endblock %}
{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'bus:tableau_bord' %}">Bus scolaire</a></li>
<li class="breadcrumb-item active" aria-current="page">Relances</li>
{% endblock %}
{% block page_actions %}
<a class="btn btn-outline-success" href="{% url 'bus:export_relances_excel' %}"><i class="fas fa-file-excel me-1"></i>Exporter Excel</a>
<a class="btn btn-outline-secondary" href="{% url 'bus:liste' %}"><i class="fas fa-list me-1"></i>Liste</a>
{% endblock %}
{% block content %}
<div class="alert alert-info"><i class="fas fa-info-circle me-1"></i> Les abonnements expirés ou proches d'expiration sont listés ci-dessous.</div>

<div class="table-container-scrollable">
<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Élève</th>
      <th>Classe</th>
      <th>École</th>
      <th>Périodicité</th>
      <th>Montant</th>
      <th>Début</th>
      <th>Expiration</th>
      <th>Statut</th>
      <th>Zone</th>
      <th>Arrêt</th>
      <th>Contact</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for a in abonnements %}
    <tr class="{% if a.est_expire %}table-danger{% elif a.est_proche_expiration %}table-warning{% endif %}">
      <td>{{ a.eleve.prenom }} {{ a.eleve.nom }} ({{ a.eleve.matricule }})</td>
      <td>{{ a.eleve.classe.nom }}</td>
      <td>{{ a.eleve.classe.ecole.nom }}</td>
      <td>{{ a.get_periodicite_display }}</td>
      <td>{{ a.montant|intcomma }} GNF</td>
      <td>{{ a.date_debut|date:'d/m/Y' }}</td>
      <td>{{ a.date_expiration|date:'d/m/Y' }}</td>
      <td>{{ a.get_statut_display }}</td>
      <td>{{ a.zone }}</td>
      <td>{{ a.point_arret }}</td>
      <td>{{ a.contact_parent }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="{% url 'bus:modifier' a.id %}"><i class="fas fa-edit"></i></a>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'bus:recu_pdf' a.id %}" target="_blank"><i class="fas fa-file-pdf"></i></a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="12" class="text-center text-muted py-4">Aucune relance</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
