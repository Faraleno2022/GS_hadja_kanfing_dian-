{% extends 'base.html' %}
{% load humanize %}
{% block title %}Bus scolaire - Abonnements{% endblock %}
{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'bus:tableau_bord' %}">Bus scolaire</a></li>
<li class="breadcrumb-item active" aria-current="page">Liste</li>
{% endblock %}
{% block page_actions %}
<a class="btn btn-success" href="{% url 'bus:nouveau' %}"><i class="fas fa-plus me-1"></i>Nouvel abonnement</a>
{% endblock %}
{% block content %}
<form method="get" class="row g-2 mb-3">
  <div class="col-md-4">
    <input type="text" name="q" class="form-control" placeholder="Rechercher (élève, zone, arrêt, contact)" value="{{ q }}">
  </div>
  <div class="col-md-2">
    <button class="btn btn-primary w-100" type="submit"><i class="fas fa-search me-1"></i>Rechercher</button>
  </div>
</form>

<div class="table-container-scrollable">
<table class="table table-striped table-hover align-middle">
  <thead>
    <tr>
      <th>Élève</th>
      <th>Classe</th>
      <th>Périodicité</th>
      <th>Montant</th>
      <th>Début</th>
      <th>Expiration</th>
      <th>Statut</th>
      <th>Zone</th>
      <th>Arrêt</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for a in abonnements %}
    <tr class="{% if a.est_expire %}table-danger{% elif a.est_proche_expiration %}table-warning{% endif %}">
      <td>{{ a.eleve.prenom }} {{ a.eleve.nom }} ({{ a.eleve.matricule }})</td>
      <td>{{ a.eleve.classe.nom }}</td>
      <td>{{ a.get_periodicite_display }}</td>
      <td>{{ a.montant|intcomma }} GNF</td>
      <td>{{ a.date_debut|date:'d/m/Y' }}</td>
      <td>{{ a.date_expiration|date:'d/m/Y' }}</td>
      <td>{{ a.get_statut_display }}</td>
      <td>{{ a.zone }}</td>
      <td>{{ a.point_arret }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="{% url 'bus:modifier' a.id %}"><i class="fas fa-edit"></i></a>
        <a class="btn btn-sm btn-outline-secondary" href="{% url 'bus:recu_pdf' a.id %}" target="_blank"><i class="fas fa-file-pdf"></i></a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="10" class="text-center text-muted py-4">Aucun abonnement trouvé</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
