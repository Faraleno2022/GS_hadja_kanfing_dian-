{% extends 'base.html' %}
{% load static %}

{% block title %}Saisie des notes — {{ evaluation.classe.nom }} / {{ evaluation.matiere.nom }}{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">
          <i class="fas fa-pen-alt me-2"></i>Saisie des notes
          <small class="text-muted d-block">{{ evaluation.titre }} — {{ evaluation.classe.nom }} / {{ evaluation.matiere.nom }}</small>
        </h5>
      </div>

      <form method="post" class="card p-3">
        {% csrf_token %}
        <div class="mb-2">
          <label class="form-label">Coller les lignes (MATRICULE;NOTE)</label>
          {{ form.donnees }}
          <small class="text-muted d-block mt-1">Exemples: PN3-042;14.5 — L11SL-007;9</small>
        </div>
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-success"><i class="fas fa-save me-1"></i>Enregistrer</button>
          <a href="{% url 'notes:matieres_classe' evaluation.classe.id %}" class="btn btn-secondary">Retour</a>
        </div>
      </form>
    </div>

    <div class="col-lg-4">
      <div class="card">
        <div class="card-header">
          <strong>Liste des élèves (aide)</strong>
        </div>
        <div class="card-body" style="max-height: 60vh; overflow:auto;">
          {% for e in eleves %}
            <div class="d-flex justify-content-between border-bottom py-1 small">
              <span>{{ e.nom }} {{ e.prenom }}</span>
              <span class="text-muted">{{ e.matricule }}</span>
            </div>
          {% empty %}
            <div class="text-muted">Aucun élève dans cette classe.</div>
          {% endfor %}
        </div>
      </div>

      <div class="card mt-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <strong>Notes enregistrées</strong>
          <small class="text-muted">{{ notes_existantes|length }} note(s)</small>
        </div>
        <div class="card-body" style="max-height: 40vh; overflow:auto;">
          {% if notes_existantes %}
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Élève</th>
                  <th>Matricule</th>
                  <th class="text-end">Note</th>
                </tr>
              </thead>
              <tbody>
                {% for n in notes_existantes %}
                  <tr>
                    <td>{{ n.eleve.nom }} {{ n.eleve.prenom }}</td>
                    <td class="text-muted">{{ n.matricule }}</td>
                    <td class="text-end">
                      <strong>{{ n.note }}</strong>
                      <br><small class="text-muted">{{ n.appreciation_finale }}</small>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <div class="text-muted">Aucune note saisie pour le moment.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
